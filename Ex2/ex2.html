<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>EXERCICI 1</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="ex2.css">
</head>

<body>
    <div id="buscador">
        <div class="input_area">
            <label for="genero">Genre: </label>
            <select name="genre" id="genre">
                <option value="" selected>All</option>
                <option value="Drama">Drama</option>
                <option value="Romance">Romance</option>
                <option value="Terror">Terror</option>
            </select>
        </div>
        <div class="input_area">
            <label for="genero">Year: </label>
            <select name="year" id="year">
                <option value="" selected>All</option>
                <option value=1999>1999</option>
                <option value=2006>2006</option>
                <option value=2009>2009</option>
                <option value=2010>2010</option>
                <option value=2011>2011</option>
                <option value=2016>2016</option>
                <option value=2017>2017</option>
                <option value=2018>2018</option>
                <option value=2019>2019</option>
                <option value=2020>2020</option>
                <option value=2021>2021</option>
                <option value=2022>2022</option>
            </select>
        </div>
        <button id="buscar">Search</button>
    </div>
    <div id="movies">
    </div>

    <script>
        $(document).ready(function () {
            $("#buscar").click(function () {
                let genre = $("#genre option:selected").text();
                let year = $("#year option:selected").text();
                $.ajax({
                    url: "https://api.themoviedb.org/3/movie/popular",
                    data: {
                        api_key: "70e3f40893b2eca95529f5c72c1a3f1c"
                    },
                    success: function (data) {
                        console.log(data);
                        var peliculas = data.results;
                        var info = "<table><tr><th></th><th>Titulo</th><th>Genero</th><th>Director</th>";
                        info += "<th>Lanzamiento</th><th>Duracion</th><th>Sinopsis</th></tr>";
                        for (var i = 0; i < peliculas.length; i++) {
                            $.ajax({
                                url: "https://api.themoviedb.org/3/movie/" + peliculas[i].id,
                                data: {
                                    api_key: "70e3f40893b2eca95529f5c72c1a3f1c"
                                },
                                success: function (filmdetails) {
                                    console.log("eee" + filmdetails);
                                    let year_date = filmdetails.release_date;
                                    console.log("aqui: " + year_date);
                                    let genre_pelicula = filmdetails.genres[0].name;
                                    year_date = year_date.substr(0, 3);
                                    if ((genre == genre_pelicula && year == year_date) || (year == "All" && genre == genre_pelicula)
                                        || (genre == "All" && year == year_date) || (genre == "All" && year == "All")) {
                                        let compania = filmdetails.production_companies.length == 0 ? "No hay" : filmdetails.production_companies[0].name;
                                        info += "<tr><td><img class='poster' src='https://image.tmdb.org/t/p/w500" + filmdetails.poster_path + "'></td>";
                                        info += "<td>" + filmdetails.original_title + "</td>";
                                        info += "<td>" + filmdetails.genres[0].name + "</td>";
                                        info += "<td>" + compania + "</td>";
                                        info += "<td>" + filmdetails.release_date + "</td>";
                                        info += "<td>" + filmdetails.runtime + " mins </td>";
                                        info += "<td id='sinopsis'>" + filmdetails.overview + "</td>";
                                        info += "</tr>";

                                    }
                                    $("#movies").html(info);
                                }
                            });
                        };
                        $("#movies").append("</table>");
                    }
                });
            });
        });
    </script>
</body>

</html>